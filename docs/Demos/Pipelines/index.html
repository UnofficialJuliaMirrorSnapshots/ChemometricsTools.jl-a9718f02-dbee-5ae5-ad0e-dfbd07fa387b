<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Pipelines · ChemometricsTools</title><link href="https://cdnjs.cloudflare.com/ajax/libs/normalize/4.2.0/normalize.min.css" rel="stylesheet" type="text/css"/><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.2.0/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link href="../../assets/documenter.css" rel="stylesheet" type="text/css"/></head><body><nav class="toc"><h1>ChemometricsTools</h1><select id="version-selector" onChange="window.location.href=this.value" style="visibility: hidden"></select><form class="search" id="search-form" action="../../search/"><input id="search-query" name="q" type="text" placeholder="Search docs"/></form><ul><li><a class="toctext" href="../../">Home</a></li><li><span class="toctext">Demos</span><ul><li><a class="toctext" href="../Transforms/">Transforms</a></li><li class="current"><a class="toctext" href>Pipelines</a><ul class="internal"></ul></li><li><a class="toctext" href="../ClassificationExample/">Classification</a></li><li><a class="toctext" href="../RegressionExample/">Regression</a></li><li><a class="toctext" href="../SIPLS/">SIPLS</a></li><li><a class="toctext" href="../CalibXfer/">Calibration Transfer</a></li><li><a class="toctext" href="../CurveResolution/">Curve Resolution</a></li></ul></li><li><span class="toctext">API</span><ul><li><a class="toctext" href="../../man/Preprocess/">Preprocessing</a></li><li><a class="toctext" href="../../man/Transformations/">Transformations/Pipelines</a></li><li><a class="toctext" href="../../man/Sampling/">Sampling</a></li><li><a class="toctext" href="../../man/Training/">Training</a></li><li><a class="toctext" href="../../man/TimeSeries/">Time Series</a></li><li><a class="toctext" href="../../man/RegressionModels/">Regression Models</a></li><li><a class="toctext" href="../../man/regressMetrics/">Regression Metrics</a></li><li><a class="toctext" href="../../man/ClassificationModels/">Classification Models</a></li><li><a class="toctext" href="../../man/classMetrics/">Classification Metrics</a></li><li><a class="toctext" href="../../man/Trees/">Tree Methods</a></li><li><a class="toctext" href="../../man/Ensemble/">Ensemble Models</a></li><li><a class="toctext" href="../../man/Clustering/">Clustering</a></li><li><a class="toctext" href="../../man/MultiWay/">MultiWay</a></li><li><a class="toctext" href="../../man/AnomalyDetection/">Anomaly Detection</a></li><li><a class="toctext" href="../../man/CurveResolution/">Curve Resolution</a></li><li><a class="toctext" href="../../man/Stats/">Stats.</a></li><li><a class="toctext" href="../../man/Dists/">Distance Measures</a></li><li><a class="toctext" href="../../man/PSO/">PSO</a></li><li><a class="toctext" href="../../man/GeneticAlgorithms/">Genetic Algorithms</a></li></ul></li><li><a class="toctext" href="../../man/FullAPI/">Full API</a></li></ul></nav><article id="docs"><header><nav><ul><li>Demos</li><li><a href>Pipelines</a></li></ul><a class="edit-page" href="https://github.com/caseykneale/ChemometricsTools.jl/blob/master/docs/src/Demos/Pipelines.md"><span class="fa"></span> Edit on GitHub</a></nav><hr/><div id="topbar"><span>Pipelines</span><a class="fa fa-bars" href="#"></a></div></header><h1><a class="nav-anchor" id="Pipelines-Demo-1" href="#Pipelines-Demo-1">Pipelines Demo</a></h1><p>Multiple <a href="https://github.com/caseykneale/ChemometricsTools/wiki/Transforms">Transformations</a> can be easily chained together and stored using &quot;Pipelines&quot;. <a href="https://github.com/caseykneale/ChemometricsTools/wiki/Preprocessing">Preprocessing</a> methods, or really any univariate function may be included in a pipeline, but that will likely mean it can no longer be inverted. Pipelines are basically convenience functions, but are somewhat flexible and can be used for automated searches,</p><pre><code class="language-julia">PreprocessPipe = Pipeline(FauxSpectra1, RangeNorm, Center);
Processed = PreprocessPipe(FauxSpectra1);</code></pre><p>Of course pipelines of transforms can also be inverted,</p><pre><code class="language-julia">RMSE( FauxSpectra1, PreprocessPipe(Processed; inverse = true) ) &lt; 1e-14</code></pre><p>Pipelines can also be created and executed as an &#39;in place&#39; operation for large datasets. This has the advantage that your data is transformed immediately without making copies in memory. This may be useful for large datasets and memory constrained environments. <em>WARNING:</em> be careful to only run the pipeline call or its inverse once! It is much safer to use the not inplace function outside of a REPL/script environment.</p><pre><code class="language-julia">FauxSpectra = randn(10,200);
OriginalCopy = copy(FauxSpectra);
InPlacePipe = PipelineInPlace(FauxSpectra, Center, Scale);</code></pre><p>See without returning the data or an extra function call we have transformed it according to the pipeline as it was instantiated...</p><pre><code class="language-julia">FauxSpectra == OriginalCopy
#Inplace transform the data back
InPlacePipe(FauxSpectra; inverse = true)
RMSE( OriginalCopy, FauxSpectra ) &lt; 1e-14</code></pre><p>Pipelines are kind of flexible. We can put nontransform (operations that cannot be inverted) preprocessing steps in them as well. In the example below the first derivative is applied to the data, this irreversibly removes a column from the data,</p><pre><code class="language-julia">PreprocessPipe = Pipeline(FauxSpectra1, FirstDerivative, RangeNorm, Center);
Processed = PreprocessPipe(FauxSpectra1);
#This should be equivalent to the following...
SpectraDeriv = FirstDerivative(FauxSpectra1);
Alternative = Pipeline(SpectraDeriv , RangeNorm, Center);
Processed == Alternative(SpectraDeriv)</code></pre><p>Great right? Well what happens if we try to do the inverse of our pipeline with an irreversible function (First Derivative) in it?</p><pre><code class="language-julia">PreprocessPipe(Processed; inverse = true)</code></pre><p>Well we get an assertion error.</p><h3><a class="nav-anchor" id="Automated-Pipeline-Example-1" href="#Automated-Pipeline-Example-1">Automated Pipeline Example</a></h3><p>We can take advantage of how pipelines are created; at their core they are tuples of transforms/functions. So if we can make an array of transforms and set some conditions they can be stored and applied to unseen data. A fun example of an automated transform pipeline is in the whimsical paper written by Willem Windig et. al. That paper is called &#39;Loopy Multiplicative Scatter Transform&#39;. Below I&#39;ll show how we can implement that algorithm here (or anything similar) with ease. <em>Loopy MSC: A Simple Way to Improve Multiplicative Scatter Correction. Willem Windig, Jeremy Shaver, Rasmus Bro. Applied Spectroscopy. 2008. Vol 62, issue: 10, 1153-1159</em></p><p>First let&#39;s look at the classic Diesel data before applying Loopy MSC <img src="https://raw.githubusercontent.com/caseykneale/ChemometricsTools/master/images/Raw.png" alt="rawspectra"/></p><p>Alright, there is scatter, let&#39;s go for it,</p><pre><code class="language-julia">RealSpectra = convert(Array, CSV.read(&quot;/diesel_spectra.csv&quot;));
Current = RealSpectra;
Last = zeros(size(Current));
TransformArray = [];
while RMSE(Last, Current) &gt; 1e-5
    if any(isnan.(Current))
        break
    else
        push!(TransformArray, MultiplicativeScatterCorrection( Current ) )
        Last = Current
        Current = TransformArray[end](Last)
    end
end
#Now we can make a pipeline object from the array of stored transforms
LoopyPipe = Pipeline( Tuple( TransformArray ) );</code></pre><p>For a sanity check we can ensure the output of the algorithm  is the same as the new pipeline so it can be applied to new data.</p><pre><code class="language-julia">Current == LoopyPipe(RealSpectra)</code></pre><p>Looks like our automation driven pipeline is equivalent to the loop it took to make it. More importantly did we remove scatter after 3 automated iterations of MSC? <img src="https://raw.githubusercontent.com/caseykneale/ChemometricsTools/master/images/Loopy.png" alt="loopymsc"/></p><p>Yes, yes we did. Pretty easy right?</p><footer><hr/><a class="previous" href="../Transforms/"><span class="direction">Previous</span><span class="title">Transforms</span></a><a class="next" href="../ClassificationExample/"><span class="direction">Next</span><span class="title">Classification</span></a></footer></article></body></html>
