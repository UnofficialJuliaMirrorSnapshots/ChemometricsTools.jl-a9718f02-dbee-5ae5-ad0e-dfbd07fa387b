<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Regression · ChemometricsTools</title><link href="https://cdnjs.cloudflare.com/ajax/libs/normalize/4.2.0/normalize.min.css" rel="stylesheet" type="text/css"/><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.2.0/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link href="../../assets/documenter.css" rel="stylesheet" type="text/css"/></head><body><nav class="toc"><h1>ChemometricsTools</h1><select id="version-selector" onChange="window.location.href=this.value" style="visibility: hidden"></select><form class="search" id="search-form" action="../../search/"><input id="search-query" name="q" type="text" placeholder="Search docs"/></form><ul><li><a class="toctext" href="../../">Home</a></li><li><span class="toctext">Demos</span><ul><li><a class="toctext" href="../Transforms/">Transforms</a></li><li><a class="toctext" href="../Pipelines/">Pipelines</a></li><li><a class="toctext" href="../ClassificationExample/">Classification</a></li><li class="current"><a class="toctext" href>Regression</a><ul class="internal"></ul></li><li><a class="toctext" href="../SIPLS/">SIPLS</a></li><li><a class="toctext" href="../CalibXfer/">Calibration Transfer</a></li><li><a class="toctext" href="../CurveResolution/">Curve Resolution</a></li></ul></li><li><span class="toctext">API</span><ul><li><a class="toctext" href="../../man/Preprocess/">Preprocessing</a></li><li><a class="toctext" href="../../man/Transformations/">Transformations/Pipelines</a></li><li><a class="toctext" href="../../man/Sampling/">Sampling</a></li><li><a class="toctext" href="../../man/Training/">Training</a></li><li><a class="toctext" href="../../man/TimeSeries/">Time Series</a></li><li><a class="toctext" href="../../man/RegressionModels/">Regression Models</a></li><li><a class="toctext" href="../../man/regressMetrics/">Regression Metrics</a></li><li><a class="toctext" href="../../man/ClassificationModels/">Classification Models</a></li><li><a class="toctext" href="../../man/classMetrics/">Classification Metrics</a></li><li><a class="toctext" href="../../man/Trees/">Tree Methods</a></li><li><a class="toctext" href="../../man/Ensemble/">Ensemble Models</a></li><li><a class="toctext" href="../../man/Clustering/">Clustering</a></li><li><a class="toctext" href="../../man/MultiWay/">MultiWay</a></li><li><a class="toctext" href="../../man/AnomalyDetection/">Anomaly Detection</a></li><li><a class="toctext" href="../../man/CurveResolution/">Curve Resolution</a></li><li><a class="toctext" href="../../man/Stats/">Stats.</a></li><li><a class="toctext" href="../../man/Dists/">Distance Measures</a></li><li><a class="toctext" href="../../man/PSO/">PSO</a></li><li><a class="toctext" href="../../man/GeneticAlgorithms/">Genetic Algorithms</a></li></ul></li><li><a class="toctext" href="../../man/FullAPI/">Full API</a></li></ul></nav><article id="docs"><header><nav><ul><li>Demos</li><li><a href>Regression</a></li></ul><a class="edit-page" href="https://github.com/caseykneale/ChemometricsTools.jl/blob/master/docs/src/Demos/RegressionExample.md"><span class="fa"></span> Edit on GitHub</a></nav><hr/><div id="topbar"><span>Regression</span><a class="fa fa-bars" href="#"></a></div></header><h1><a class="nav-anchor" id="Regression/Training-Demo:-1" href="#Regression/Training-Demo:-1">Regression/Training Demo:</a></h1><p>This demo shows a few ways to build a PLS regression model and perform cross validation. If you want to see the gambit of regression methods included in ChemometricsTools check the <a href="https://github.com/caseykneale/ChemometricsTools/blob/master/shootouts/RegressionShootout.jl">regression shootout</a> example.</p><p>There are a few built-in&#39;s to make training models a snap. Philosophically I decided, that making wrapper functions to perform Cross Validation is not fair to the end-user. There are many cases where we want specialized CV&#39;s but we don&#39;t want to write nested for-loops that run for hours then debug them... Similarly, most people don&#39;t want to spend their time hacking into rigid GridSearch objects, or scouring stack exchange / package documentation. Especially when it&#39;d be easier to write an equivalent approach that is self documenting from scratch. Instead, I used Julia&#39;s iterators to make K-Fold validations convenient, below is an example Partial Least Squares Regression CV.</p><pre><code class="language-julia">#Split our data into two parts one 70% one 30%
((TrainX,TrainY),(TestX, TestY)) = SplitByProportion(x, yprop, 0.7);
#Preprocess it
MSC_Obj = MultiplicativeScatterCorrection(TrainX);
TrainX = MSC_Obj(TrainX);
TestX = MSC_Obj(TestX);
#Begin CV!
LatentVariables = 22
Err = repeat([0.0], LatentVariables);
#Note this is the Julian way to nest two loops
for Lv in 1:LatentVariables, (Fold, HoldOut) in KFoldsValidation(20, TrainX, TrainY)
    PLSR = PartialLeastSquares(Fold[1], Fold[2]; Factors = Lv)
    Err[Lv] += SSE( PLSR(HoldOut[1]), HoldOut[2] )
end
scatter(Err, xlabel = &quot;Latent Variables&quot;, ylabel = &quot;Cumulative SSE&quot;, labels = [&quot;Error&quot;])
BestLV = argmin(Err)
PLSR = PartialLeastSquares(TrainX, TrainY; Factors = BestLV)
RMSE( PLSR(TestX), TestY )</code></pre><p><img src="https://raw.githubusercontent.com/caseykneale/ChemometricsTools/master/images/CV.png" alt="20folds"/></p><p>That&#39;s great right? but, hey that was kind of slow. Knowing what we know about ALS based models, we can do the same operation in linear time with respect to latent factors by computing the most latent variables first and only recomputing the regression coefficients. An example of this is below,</p><pre><code class="language-julia">Err = repeat([0.0], 22);
Models = []
for Lv in 22:-1:1
    for ( i, ( Fold, HoldOut ) ) in enumerate(KFoldsValidation(20, TrainX, TrainY))
        if Lv == 22
            push!( Models, PartialLeastSquares(Fold[1], Fold[2]; Factors = Lv) )
        end
        Err[Lv] += SSE( Models[i]( HoldOut[1]; Factors = Lv), HoldOut[2] )
    end
end</code></pre><p>This approach is ~5 times faster on a single core( &lt; 2 seconds), pours through 7Gb less data, and makes 1/5th the allocations (on this dataset at least). If you wanted you could distribute the inner loop (using Distributed.jl) and see drastic speed ups!</p><footer><hr/><a class="previous" href="../ClassificationExample/"><span class="direction">Previous</span><span class="title">Classification</span></a><a class="next" href="../SIPLS/"><span class="direction">Next</span><span class="title">SIPLS</span></a></footer></article></body></html>
