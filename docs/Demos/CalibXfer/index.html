<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Calibration Transfer · ChemometricsTools</title><link href="https://cdnjs.cloudflare.com/ajax/libs/normalize/4.2.0/normalize.min.css" rel="stylesheet" type="text/css"/><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.2.0/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link href="../../assets/documenter.css" rel="stylesheet" type="text/css"/></head><body><nav class="toc"><h1>ChemometricsTools</h1><select id="version-selector" onChange="window.location.href=this.value" style="visibility: hidden"></select><form class="search" id="search-form" action="../../search/"><input id="search-query" name="q" type="text" placeholder="Search docs"/></form><ul><li><a class="toctext" href="../../">Home</a></li><li><span class="toctext">Demos</span><ul><li><a class="toctext" href="../Transforms/">Transforms</a></li><li><a class="toctext" href="../Pipelines/">Pipelines</a></li><li><a class="toctext" href="../ClassificationExample/">Classification</a></li><li><a class="toctext" href="../RegressionExample/">Regression</a></li><li><a class="toctext" href="../SIPLS/">SIPLS</a></li><li class="current"><a class="toctext" href>Calibration Transfer</a><ul class="internal"><li><a class="toctext" href="#Direct-Standardization-Demo-1">Direct Standardization Demo</a></li></ul></li><li><a class="toctext" href="../CurveResolution/">Curve Resolution</a></li></ul></li><li><span class="toctext">API</span><ul><li><a class="toctext" href="../../man/Preprocess/">Preprocessing</a></li><li><a class="toctext" href="../../man/Transformations/">Transformations/Pipelines</a></li><li><a class="toctext" href="../../man/Sampling/">Sampling</a></li><li><a class="toctext" href="../../man/Training/">Training</a></li><li><a class="toctext" href="../../man/TimeSeries/">Time Series</a></li><li><a class="toctext" href="../../man/RegressionModels/">Regression Models</a></li><li><a class="toctext" href="../../man/regressMetrics/">Regression Metrics</a></li><li><a class="toctext" href="../../man/ClassificationModels/">Classification Models</a></li><li><a class="toctext" href="../../man/classMetrics/">Classification Metrics</a></li><li><a class="toctext" href="../../man/Trees/">Tree Methods</a></li><li><a class="toctext" href="../../man/Ensemble/">Ensemble Models</a></li><li><a class="toctext" href="../../man/Clustering/">Clustering</a></li><li><a class="toctext" href="../../man/MultiWay/">MultiWay</a></li><li><a class="toctext" href="../../man/AnomalyDetection/">Anomaly Detection</a></li><li><a class="toctext" href="../../man/CurveResolution/">Curve Resolution</a></li><li><a class="toctext" href="../../man/Stats/">Stats.</a></li><li><a class="toctext" href="../../man/Dists/">Distance Measures</a></li><li><a class="toctext" href="../../man/PSO/">PSO</a></li><li><a class="toctext" href="../../man/GeneticAlgorithms/">Genetic Algorithms</a></li></ul></li><li><a class="toctext" href="../../man/FullAPI/">Full API</a></li></ul></nav><article id="docs"><header><nav><ul><li>Demos</li><li><a href>Calibration Transfer</a></li></ul><a class="edit-page" href="https://github.com/caseykneale/ChemometricsTools.jl/blob/master/docs/src/Demos/CalibXfer.md"><span class="fa"></span> Edit on GitHub</a></nav><hr/><div id="topbar"><span>Calibration Transfer</span><a class="fa fa-bars" href="#"></a></div></header><h2><a class="nav-anchor" id="Direct-Standardization-Demo-1" href="#Direct-Standardization-Demo-1">Direct Standardization Demo</a></h2><p>The point of this demo is to basically show off that ChemometricsTools contains some base methods for Calibration Transfer. If you don&#39;t know what that is, it&#39;s basically the subset of Chemometrics that focuses on transfer learning data collected on one instrument to another. This saves time and money for instruments that need to be calibrated but perform routine analysis&#39;.</p><p>This demo uses the 2002 pharmaceutical shoot-out data and predicts upon the first property value(pretty sure its API content). The dataset contains the same samples of an unstated pharmaceutical measured on two spectrometers with experimentally determined property values. Our goal will be to use one model but adapt the domain from one of the spectrometers to the other.</p><p>First let&#39;s look at our linear sources of variation to get a feel for the data,</p><pre><code class="language-julia">pca = PCA(calib1; Factors = 20);
plot(cumsum(ExplainedVariance(pca)), title = &quot;Scree plot&quot;, xlabel = &quot;PC&#39;s&quot;, ylabel = &quot;Variance Explained&quot;)</code></pre><p><img src="https://raw.githubusercontent.com/caseykneale/ChemometricsTools/master/images/CalibTransferDemo/scree.png " alt="scree"/></p><p><em>Yea so this isn&#39;t a true Scree plot, but it has the same information...</em></p><p>Looks like after ~5 factors we have garbage w.r.t X decompositions, good to know. So I&#39;d venture to guess a maximum of 15 Latent Variables for a PLS-1 regression is more than a good enough cut-off for cross-validaiton.</p><pre><code class="language-julia">MaxLvs = 15
Err = repeat([0.0], MaxLvs);
Models = []
for Lv in MaxLvs:-1:1
    for ( i, ( Fold, HoldOut ) ) in enumerate(KFoldsValidation(10, calib1, caliby))
        if Lv == MaxLvs
            push!( Models, PartialLeastSquares(Fold[1], Fold[2]; Factors = Lv) )
        end
        Err[Lv] += SSE( Models[i]( HoldOut[1]; Factors = Lv), HoldOut[2] )
    end
end

scatter(Err, xlabel = &quot;Latent Variables&quot;, ylabel = &quot;Cumulative SSE&quot;, labels = [&quot;Error&quot;])</code></pre><p><img src="https://raw.githubusercontent.com/caseykneale/ChemometricsTools/master/images/CalibTransferDemo/CV.png " alt="cv"/></p><p>Great looks like we can get by with 5-8 LV&#39;s. Let&#39;s fine tune our Latent Variables based on the hold out set to make our final PLSR model.</p><pre><code class="language-julia">PLSR1 = PartialLeastSquares(calib1, caliby; Factors = 8);
for vLv in 5:8
    println(&quot;LV: &quot;, vLv)
    println(&quot;RMSEV: &quot;, RMSE(PLSR1(valid1; Factors = vLv), validy))
end</code></pre><p>Kind of hacky, but it works fine for a demo, we see that 7 factors is optimal on the hold out set so that&#39;s what we&#39;ll use from here on,</p><pre><code class="language-julia">println(&quot;RMSEP: &quot;, RMSE(PLSR1(tst1; Factors = 7), tsty))</code></pre><p><code>&gt; RMSEP: 4.76860402876937</code></p><h3><a class="nav-anchor" id="Getting-to-the-point-1" href="#Getting-to-the-point-1">Getting to the point</a></h3><p>So why do we need to do a calibration transfer? Same chemical, same type of measurements, even the same wavelengths are recorded and compared. Do the naive thing, apply this model to the measurements on instrument 2. See what error you get.</p><pre><code class="language-julia">println(&quot;RMSEP: &quot;, RMSE(PLSR1(tst2; Factors = 7), tsty))</code></pre><p><code>&gt;RMSEP: 10.303430504546292</code></p><p>The prediction error is about 2 fold, in this case it&#39;d be hard to argue this is a useful model at all. Especially if you check the residuals. It&#39;s pretty clear the contributions of variance across multiple instruments are not the same in this case.</p><h3><a class="nav-anchor" id="Now-for-calibration-transfer!-1" href="#Now-for-calibration-transfer!-1">Now for calibration transfer!</a></h3><p>So let&#39;s use DirectStandardization. First we&#39;ll find the optimal number of DirectStandardization Factors to include in our model. We can do that on our hold out set and this should be very fast because we have a hold out set, so we can do this with some inefficient code.</p><pre><code class="language-julia">Factors = 1:15
Err = repeat([0.0], length(Factors));
for F in Factors
    DS2to1 = DirectStandardization(calib1, calib2; Factors = F);
    cds2to1 = DS2to1(valid2; Factors = F)
    Err[F] = RMSE( PLSR1(cds2to1; Factors = 7), validy )
end
scatter(Err, title = &quot;Transfered Model Validation Error&quot;, xlabel = &quot;Latent Factors&quot;,
        ylabel = &quot;RMSE&quot;, labels = [&quot;Error&quot;])</code></pre><p><img src="https://raw.githubusercontent.com/caseykneale/ChemometricsTools/master/images/CalibTransferDemo/DSvalerror.png " alt="cv"/></p><pre><code class="language-julia">OptimalDSFactor = argmin(Err)
DS2to1 = DirectStandardization(calib1, calib2; Factors = OptimalDSFactor);
tds2to1 = DS2to1(tst2; Factors = OptimalDSFactor);</code></pre><p>Looks like 8 Factors in the DS transfer is pretty good. Lets see how the transferred data compares on the prediction set using the same model,</p><pre><code class="language-julia">println(&quot;RMSEP: &quot;, RMSE(PLSR1(tds2to1; Factors = 7), tsty))</code></pre><p><code>&gt; RMSEP: 5.693023386113084</code></p><p>Viola... So in conclusion we can transform the data from instrument 2 to be similar to that of instrument 1. The errors we see are effectively commensurate between the data sources with this transform, and without it the error is about 2x greater. Maybe the main point here is &quot;look ChemometricsTools has some calibration transfer methods and the tools included work&quot;. OSC, TOP, CORAL, etc is also included.</p><footer><hr/><a class="previous" href="../SIPLS/"><span class="direction">Previous</span><span class="title">SIPLS</span></a><a class="next" href="../CurveResolution/"><span class="direction">Next</span><span class="title">Curve Resolution</span></a></footer></article></body></html>
